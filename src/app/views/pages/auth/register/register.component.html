<app-landing-navbar></app-landing-navbar>
<div class="auth-bg">
  <div class="auth-card split">
    <div class="auth-form">
      <div *ngIf="loading" class="spinner-overlay">
        <div class="spinner"></div>
      </div>
      <a routerLink="." class="nobleui-logo d-block mb-2">LMIS</a>
      <h5 class="text-muted fw-normal mb-4 text-center">Create an account.</h5>
      <form class="forms-sample" [formGroup]="signupForm">
        <div class="mb-3">
          <label for="exampleInputUsername1" class="form-label">Username</label>
          <input
            type="text"
            class="form-control"
            id="exampleInputUsername1"
            autocomplete="Username"
            placeholder="Username"
            formControlName="username"
            [ngClass]="{
              'is-invalid':
                signupForm.get('username').touched &&
                signupForm.get('username').invalid
            }"
          />
          <div
            *ngIf="
              signupForm.get('username').touched &&
              signupForm.get('username').invalid
            "
            class="invalid-feedback d-block"
          >
            <div *ngIf="signupForm.get('username').errors?.required">
              Username is required.
            </div>
            <div *ngIf="signupForm.get('username').errors?.minlength">
              Username must be at least 4 characters.
            </div>
            <div *ngIf="signupForm.get('username').errors?.maxlength">
              Username must be at most 20 characters.
            </div>
          </div>
        </div>
        <div class="mb-3 name-group">
          <div class="name-fields">
            <div class="first-name-field">
              <label for="firstName" class="form-label">First Name</label>
              <input
                type="text"
                class="form-control"
                id="firstName"
                autocomplete="Username"
                placeholder="First Name"
                formControlName="firstName"
                [ngClass]="{
                  'is-invalid':
                    signupForm.get('firstName').touched &&
                    signupForm.get('firstName').invalid
                }"
              />
              <div
                *ngIf="
                  signupForm.get('firstName').touched &&
                  signupForm.get('firstName').invalid
                "
                class="invalid-feedback d-block"
              >
                <div *ngIf="signupForm.get('firstName').errors?.required">
                  First name is required.
                </div>
                <div *ngIf="signupForm.get('firstName').errors?.maxlength">
                  First name must be at most 30 characters.
                </div>
              </div>
            </div>
            <div class="last-name-field">
              <label for="lastName" class="form-label">Last Name</label>
              <input
                type="text"
                class="form-control"
                id="lastName"
                autocomplete="Username"
                placeholder="Last Name"
                formControlName="lastName"
                [ngClass]="{
                  'is-invalid':
                    signupForm.get('lastName').touched &&
                    signupForm.get('lastName').invalid
                }"
              />
              <div
                *ngIf="
                  signupForm.get('lastName').touched &&
                  signupForm.get('lastName').invalid
                "
                class="invalid-feedback d-block"
              >
                <div *ngIf="signupForm.get('lastName').errors?.required">
                  Last name is required.
                </div>
                <div *ngIf="signupForm.get('lastName').errors?.maxlength">
                  Last name must be at most 30 characters.
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label for="exampleInputEmail1" class="form-label"
            >Contact Number</label
          >
          <input
            type="text"
            class="form-control"
            id="exampleInputEmail1"
            placeholder="09"
            maxlength="11"
            formControlName="contactNumber"
            inputmode="tel"
            [ngClass]="{
              'is-invalid':
                signupForm.get('contactNumber').touched &&
                signupForm.get('contactNumber').invalid
            }"
          />
          <div
            *ngIf="
              signupForm.get('contactNumber').touched &&
              signupForm.get('contactNumber').invalid
            "
            class="invalid-feedback d-block"
          >
            <div *ngIf="signupForm.get('contactNumber').errors?.required">
              Contact number is required.
            </div>
            <div *ngIf="signupForm.get('contactNumber').errors?.pattern">
              Contact number must be 11 digits.
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Location</label>
          <div class="location-group d-flex flex-wrap gap-2">
            <div class="flex-fill">
              <div ngbDropdown class="w-100">
                <button
                  type="button"
                  class="form-control btn btn-outline-secondary text-start dropdown-toggle"
                  ngbDropdownToggle
                  [ngClass]="{
                    'is-invalid':
                      signupForm.get('municipality').touched &&
                      (!selectedMunicipality ||
                        signupForm.get('municipality').invalid)
                  }"
                >
                  {{ selectedMunicipality?.name || "Select Municipality" }}
                </button>
                <div
                  *ngIf="
                    signupForm.get('municipality').touched &&
                    (!selectedMunicipality ||
                      signupForm.get('municipality').invalid)
                  "
                  class="invalid-feedback d-block"
                >
                  Municipality is required.
                </div>
                <div ngbDropdownMenu class="w-100">
                  <button
                    type="button"
                    ngbDropdownItem
                    *ngFor="let municipality of municipalities"
                    (click)="selectMunicipality(municipality)"
                  >
                    {{ municipality.name }}
                  </button>
                </div>
              </div>
            </div>
            <div class="flex-fill">
              <div ngbDropdown class="w-100">
                <button
                  type="button"
                  class="form-control btn btn-outline-secondary text-start dropdown-toggle"
                  ngbDropdownToggle
                  [disabled]="!selectedMunicipality"
                  [ngClass]="{
                    'is-invalid':
                      signupForm.get('barangay').touched &&
                      (!selectedBarangay || signupForm.get('barangay').invalid)
                  }"
                >
                  {{ selectedBarangay?.name || "Select Barangay" }}
                </button>
                <div
                  *ngIf="
                    signupForm.get('barangay').touched &&
                    (!selectedBarangay || signupForm.get('barangay').invalid)
                  "
                  class="invalid-feedback d-block"
                >
                  Barangay is required.
                </div>
                <div ngbDropdownMenu class="w-100">
                  <button
                    type="button"
                    ngbDropdownItem
                    *ngFor="let barangay of barangays"
                    (click)="selectBarangay(barangay)"
                  >
                    {{ barangay.name }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label for="exampleInputPassword1" class="form-label">Password</label>
          <input
            type="password"
            class="form-control"
            id="exampleInputPassword1"
            autocomplete="current-password"
            placeholder="Password"
            formControlName="password"
            [ngClass]="{
              'is-invalid':
                signupForm.get('password').touched &&
                signupForm.get('password').invalid
            }"
          />
          <div
            *ngIf="
              signupForm.get('password').touched &&
              signupForm.get('password').invalid
            "
            class="invalid-feedback d-block"
          >
            <div *ngIf="signupForm.get('password').errors?.required">
              Password is required.
            </div>
            <div *ngIf="signupForm.get('password').errors?.minlength">
              Password must be at least 6 characters.
            </div>
            <div *ngIf="signupForm.get('password').errors?.maxlength">
              Password must be at most 32 characters.
            </div>
          </div>
        </div>
        <div>
          <button
            type="submit"
            class="btn btn-primary w-100 modern-btn"
            (click)="onRegister($event)"
            [disabled]="loading"
          >
            Sign up
          </button>
        </div>
        <a routerLink="/auth/login" class="d-block mt-3 text-muted text-center">
          Already a user? Sign in
        </a>
      </form>
    </div>
  </div>
</div>
<app-landing-footer></app-landing-footer>
